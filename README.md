# GPU Lithography Library (GpuLithoLib)

A high-performance GPU-accelerated library for computational lithography operations on polygon layers.

## Features

- **Layer Management**: Create polygon layers from files or geometric configurations
- **Boolean Operations**: Intersection, Union, Difference, XOR operations on polygon layers
- **Geometric Operations**: Offset (grow/shrink) operations
- **GPU Acceleration**: All operations performed on GPU with CUDA/HIP support
- **Visualization**: Generate PNG images of polygon layers
- **File I/O**: Import/export polygon data in text format

## Quick Start

### 1. Build the Library

The library supports both **CUDA** (NVIDIA GPUs) and **HIP** (AMD GPUs).

#### For CUDA (NVIDIA GPUs):
```bash
cd GpuLithoLib
mkdir build && cd build
cmake -DGPU_BACKEND=CUDA ..
make -j$(nproc)
```

**Requirements:**
- CUDA Toolkit 11.0+ (tested with 12.2)
- Compute capabilities: 52, 60, 61, 70, 75, 80, 86, 89, 90
- OpenCV 4.0+
- CMake 3.18+

#### For HIP (AMD GPUs):
```bash
cd GpuLithoLib
mkdir build && cd build
cmake -DGPU_BACKEND=HIP ..
make -j$(nproc)
```

**Requirements:**
- ROCm 5.0+ with HIP runtime
- Architectures: gfx900, gfx906, gfx908, gfx90a, gfx1030, gfx1100
- OpenCV 4.0+
- CMake 3.18+

#### Auto-Detection:
```bash
cd GpuLithoLib
mkdir build && cd build
cmake ..  # Auto-detects CUDA or HIP
make -j$(nproc)
```
The build system will automatically detect `nvcc` (CUDA) or `hipcc` (HIP) and configure accordingly.

### 2. Basic Usage

```cpp
#include "GpuLithoLib.h"
using namespace GpuLithoLib;

// Create engine
GpuLithoEngine engine(10000, 10000);

// Create layers from geometry
GeometryConfig config;
config.shape = GeometryConfig::RECTANGLE;
config.centerX = 1000;
config.centerY = 1000;
config.width = 800;
config.height = 600;

Layer rectangleLayer = engine.createLayerFromGeometry(config);

// Create from file
Layer fileLayer = engine.createLayerFromFile("input.txt", 0);

// Boolean operations
Layer intersection = engine.layerIntersection(rectangleLayer, fileLayer);
Layer union_result = engine.layerUnion(rectangleLayer, fileLayer);
Layer difference = engine.layerDifference(rectangleLayer, fileLayer);
Layer xor_result = engine.layerXor(rectangleLayer, fileLayer);

// Geometric operations
Layer offset_positive = engine.layerOffset(rectangleLayer, 50);  // Grow
Layer offset_negative = engine.layerOffset(rectangleLayer, -30); // Shrink

// Output
engine.visualizeLayer(intersection, "result.png");
engine.dumpLayerToFile(intersection, "result.txt", 0);
```

### 3. Run Examples

```bash
# From build/ directory
./example_usage           # Comprehensive demo of all features
./test_intersection       # Focused intersection operation test
```

Both examples generate PNG visualizations and demonstrate the library's capabilities.

## API Reference

### GpuLithoEngine

Main engine class for lithography operations.

#### Constructor
```cpp
GpuLithoEngine(unsigned int gridWidth = 10000, unsigned int gridHeight = 10000);
```

#### Layer Creation
```cpp
Layer createLayerFromFile(const std::string& filename, unsigned int layerIndex = 0);
Layer createLayerFromGeometry(const GeometryConfig& config);
```

#### Boolean Operations
```cpp
Layer layerIntersection(const Layer& layer1, const Layer& layer2);
Layer layerUnion(const Layer& layer1, const Layer& layer2);
Layer layerDifference(const Layer& layer1, const Layer& layer2);
Layer layerXor(const Layer& layer1, const Layer& layer2);
```

#### Geometric Operations
```cpp
Layer layerOffset(const Layer& layer, int offsetDistance);
```

#### Output Methods
```cpp
bool dumpLayerToFile(const Layer& layer, const std::string& filename, unsigned int layerIndex = 0);
bool visualizeLayer(const Layer& layer, const std::string& filename, bool showVertices = false);
```

### GeometryConfig

Configuration for creating geometric layers.

#### Shape Types
- `RECTANGLE`: Rectangular shapes
- `CIRCLE`: Circular shapes (approximated by polygons)
- `REGULAR_POLYGON`: Regular polygons with specified number of sides
- `L_SHAPE`: L-shaped patterns

#### Key Parameters
```cpp
struct GeometryConfig {
    ShapeType shape = RECTANGLE;
    unsigned int centerX = 0, centerY = 0;
    unsigned int width = 100, height = 100;
    unsigned int radius = 50;
    unsigned int numSides = 6;
    unsigned int thickness = 20;
    
    // Grid parameters for multiple shapes
    unsigned int gridWidth = 1, gridHeight = 1;
    unsigned int spacingX = 200, spacingY = 200;
};
```

### Layer

Handle to a polygon layer in GPU memory.

#### Methods
```cpp
bool empty() const;
unsigned int getPolygonCount() const;
unsigned int getVertexCount() const;
std::vector<unsigned int> getBoundingBox() const;  // {minX, minY, maxX, maxY}
```

## File Format

Input/output text files use a simple format:
```
GDSII Library
Generated by GpuLithoLib
LAYER 0
BOUNDARY
LAYER 0
DATATYPE 0
XY
100 100
200 100
200 200
100 200
100 100
ENDEL
ENDSTR
ENDLIB
```

## Performance

- All polygon operations performed on GPU
- Automatic memory management
- Built-in profiling support:

```cpp
engine.enableProfiling(true);
// ... perform operations ...
engine.printPerformanceStats();
```

## Platform Support

### CUDA (NVIDIA GPUs)
- **CUDA Toolkit**: 11.0+ (tested with 12.2)
- **Compute Capabilities**: 52, 60, 61, 70, 75, 80, 86, 89, 90
- **OpenCV**: 4.0+
- **CMake**: 3.18+
- **Build**: `cmake -DGPU_BACKEND=CUDA ..`

### HIP (AMD GPUs)
- **ROCm**: 5.0+ with HIP runtime
- **Architectures**: gfx900, gfx906, gfx908, gfx90a, gfx1030, gfx1100
- **OpenCV**: 4.0+
- **CMake**: 3.18+
- **Build**: `cmake -DGPU_BACKEND=HIP ..`

### Auto-Detection
The build system automatically detects available GPU platform (CUDA â†’ HIP priority).

## Examples

See `examples/example_usage.cu` for comprehensive usage examples including:
- Creating different layer types
- Boolean operations workflow
- Complex multi-step processing
- Performance profiling

## Architecture

The library is built on the existing GPU lithography codebase with:
- Simplified API for ease of use
- Automatic GPU memory management
- Platform abstraction (CUDA/HIP)
- Integration with OpenCV for visualization

## License

[Add your license information here]